---
import itTranslations from "../i18n/it.json";
import enTranslations from "../i18n/en.json";

interface Props {
  lang?: "it" | "en";
}

const { lang = "it" } = Astro.props;
const translations = lang === "it" ? itTranslations : enTranslations;
const t = translations.form;
const privacyUrl = lang === "it" ? "/privacy" : "/en/privacy";
---

<div class="form-container">
  <form
    id="contact-form"
    action="https://docs.google.com/forms/d/e/1FAIpQLScnaH0LSaFeGr3zfgHD8FLc9iI_DKLUbmDHOzaYEhT1wNyupg/formResponse"
    method="POST"
    target="hidden_iframe"
    onsubmit="submitted = true;"
  >
    <div>
      <label for="nome">{t.name}</label><br />
      <input
        type="text"
        id="nome"
        name="entry.47521721"
        placeholder={t.namePlaceholder}
        required
      />
    </div>

    <div>
      <label for="email">{t.email}</label><br />
      <input
        type="email"
        id="email"
        name="entry.706882435"
        placeholder={t.emailPlaceholder}
        required
      />
    </div>

    <div>
      <label for="dove">{t.meetingType}</label><br />
      <select name="entry.1289812636" id="tipoincontro" required>
        <option value="" disabled selected>{t.meetingTypePlaceholder}</option>
        <option value="Video chiamata">{t.meetingTypeVideo}</option>
        <option value="In ufficio">{t.meetingTypeOffice}</option>
        <option value="Propria sede">{t.meetingTypeCustomer}</option>
      </select>    
    </div>

      <div>
        <label for="messaggio">{t.message}</label><br />
        <textarea
          id="messaggio"
          name="entry.399495840"
          placeholder={t.messagePlaceholder}
          rows="5"
          required></textarea>
      </div>

      <div class="privacy-container">
        <input 
          type="checkbox" 
          id="privacy-checkbox" 
          name="privacy" 
          required
        />
        <label for="privacy-checkbox" class="privacy-label">
          {t.privacyText} <a href={privacyUrl} target="_blank">{t.privacyLink}</a>
        </label>
      </div>

      <button type="submit" id="submit-button" disabled>{t.submit}</button>

    <p id="success-message" class="success-message">
      {t.successMessage}
    </p>

    <iframe
      name="hidden_iframe"
      style="display:none;"
      onload="if (submitted) showSuccessMessage();"></iframe>
  </form>

  <script is:inline>
    let submitted = false;

    function showSuccessMessage() {
      submitted = false;

      const form = document.getElementById("contact-form");
      const successMessage = document.getElementById("success-message");

      form.reset();
      successMessage.style.display = "block";
      
      // Reset button state after form reset
      const submitButton = document.getElementById("submit-button");
      if (submitButton) {
        submitButton.disabled = true;
      }
    }

    // Enable/disable submit button based on checkbox state
    document.addEventListener("DOMContentLoaded", function() {
      const checkbox = document.getElementById("privacy-checkbox");
      const submitButton = document.getElementById("submit-button");
      
      if (checkbox && submitButton) {
        checkbox.addEventListener("change", function() {
          submitButton.disabled = !checkbox.checked;
        });
      }
    });
  </script>

  <style>
    .form-container {
      max-width: 600px;
      margin: 80px auto;
      padding: 20px;
      background-color: var(--yellow);
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .form-container div {
      margin-bottom: 16px;
    }

    .form-container label {
      font-weight: 600;
    }

    .form-container input,
    .form-container select,
    .form-container textarea {
      width: 100%;
      padding: 8px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-family: inherit;
    }

    .privacy-container {
      display: flex;
      align-items: flex-start;
      gap: 8px;
      margin-bottom: 20px;
    }

    .privacy-container input[type="checkbox"] {
      width: auto;
      margin-top: 4px;
      cursor: pointer;
    }

    .privacy-label {
      font-weight: 400;
      font-size: 0.95rem;
      line-height: 1.5;
      cursor: pointer;
    }

    .privacy-label a {
      color: var(--brown);
      text-decoration: underline;
      font-weight: 600;
    }

    .privacy-label a:hover {
      opacity: 0.8;
    }

    .form-container button {
      padding: 10px 20px;
      border-radius: 8px;
      border: none;
      background-color: var(--brown);
      color: white;
      font-weight: 600;
      cursor: pointer;
      transition: opacity 0.3s ease;
    }

    .form-container button:hover:not(:disabled) {
      opacity: 0.9;
    }

    .form-container button:disabled {
      background-color: #ccc;
      cursor: not-allowed;
      opacity: 0.6;
    }

    .success-message {
      display: none;
      margin-top: 20px;
      padding: 12px;
      background-color: #e6f7e6;
      color: #1e7a1e;
      border-radius: 8px;
      text-align: center;
      font-weight: 500;
    }

    @media (max-width: 768px) {
      .form-container {
        margin: 40px 20px;
      }
    }
  </style>
</div>
